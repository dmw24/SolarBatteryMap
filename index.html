<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Solar & Battery Map</title>
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
    #controls { padding: 10px; background: #f7f7f7; }
    label { margin-right: 15px; }
    input[type=range] { vertical-align: middle; }
    span.value { font-weight: bold; margin-left: 5px; }
    #map { height: 90vh; width: 100%; }
  </style>
</head>
<body>
  <div id="controls">
    <label for="solarSlider">
      Solar:
      <input type="range" id="solarSlider" min="1" max="10" step="1" value="1" />
      <span id="solarVal" class="value">1</span>
    </label>
    <label for="batterySlider">
      Battery:
      <input type="range" id="batterySlider" min="1" max="15" step="1" value="1" />
      <span id="batteryVal" class="value">1</span>
    </label>
  </div>
  <div id="map"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Sample data: Location, Solar_GW, Battery_GWh, System_Capacity_Factor
    const data = [
      { loc: 'Lat-69.3_Lon100.7', solar: 1, battery: 1, scf: 0.21579751253887666 },
      { loc: 'Lat-69.3_Lon100.7', solar: 1, battery: 2, scf: 0.21579751253887666 },
      { loc: 'Lat-69.3_Lon100.7', solar: 1, battery: 3, scf: 0.21579751253887666 }
      // ... add full dataset here ...
    ];

    // Parse lat/lon strings
    data.forEach(d => {
      const parts = /Lat-?([\d.]+)_Lon-?([\d.]+)/.exec(d.loc);
      d.lat = parseFloat(parts[1]);
      d.lon = parseFloat(parts[2]);
    });

    // Initialize map
    const map = L.map('map').setView([20, 0], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    // Layer group for markers
    const markers = L.layerGroup().addTo(map);

    // Color: blue (low) to red (high)
    function getColor(val) {
      const hue = (1 - val) * 240; // 240 = blue, 0 = red
      return `hsl(${hue}, 100%, 50%)`;
    }

    // Draw markers based on slider values
    function updateMarkers() {
      const solarSel = Number(document.getElementById('solarSlider').value);
      const batterySel = Number(document.getElementById('batterySlider').value);
      document.getElementById('solarVal').textContent = solarSel;
      document.getElementById('batteryVal').textContent = batterySel;
      markers.clearLayers();
      const subset = data.filter(d => d.solar === solarSel && d.battery === batterySel);
      subset.forEach(d => {
        L.circleMarker([d.lat, d.lon], {
          radius: 8,
          fillColor: getColor(d.scf),
          color: '#000',
          weight: 1,
          fillOpacity: 0.8
        }).addTo(markers)
          .bindPopup(`<strong>${d.loc}</strong><br>SCF: ${d.scf.toFixed(3)}`);
      });
      if (subset.length) {
        const bounds = subset.map(d => [d.lat, d.lon]);
        map.fitBounds(bounds, { padding: [20, 20] });
      }
    }

    // Hook slider events
    document.getElementById('solarSlider').addEventListener('input', updateMarkers);
    document.getElementById('batterySlider').addEventListener('input', updateMarkers);

    // Initial render
    updateMarkers();
  </script>
</body>
</html>
